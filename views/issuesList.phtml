<table>
    <thead>
        <tr>
            <th>Priorit√©</th>
            <th>Type</th>
            <th>Key</th>
            <th>Titre</th>
            <th>Status</th>
            <th>Date de cr√©ation</th>
            <th>1er passage √† En cours</th>
            <th>Date de r√©solution (Termin√©)</th>
            <th>Lead time</th>
            <th>Cycle time</th>
        </tr>
    </thead>
    <tbody>
        <?php foreach ($view->getIssues() as $issue): ?>
            <?php /** @var \App\Model\Issue $issue */ ?>
            <tr>
                <td><img src="<?= $issue->getPriorityIcon() ?? '' ?>" /><?= $issue->getPriorityName() ?? '‚Äî'; ?></td>
                <td><img src="<?= $issue->getIssueTypeIcon() ?? '' ?>" /><?= $issue->getIssueTypeName() ?? '‚Äî'; ?></td>
                <td><strong><?= $issue->getKey(); ?></strong></td>
                <td><a href="<?= $issue->getIssueUrl(); ?>" target="_blank"><?= htmlspecialchars($issue->getSummary()); ?></a></td>
                <td class="<?= $issue->getStatusCategoryColor() ?>"><?= $issue->getStatusName() ?? '‚Äî'; ?></td>
                <td><?= $issue->getCreatedDate() ?? '‚Äî'; ?></td>
                <td><?= $issue->getFirstInProgressDate() ?? '‚Äî'; ?></td>
                <td><?= $issue->getDoneDate() ?? '‚Äî'; ?></td>
                <td><?= $issue->getLeadTime() > 0 ? $issue->getLeadTime() . ' jours' : '‚Äî'; ?></td>
                <td><?= $issue->getCycleTime() > 0 ? $issue->getCycleTime() . ' jours' : '‚Äî'; ?></td>
            </tr>
            <tr>
                <td colspan="11">
                    <!-- Affichage des √©tiquettes "attente", indiquant un blocage temporaire -->
                    <?php if ($issue->getWaitingTimes()): ?>
                        ‚è≥ Mises en attente :
                        <?php foreach ($issue->getWaitingTimes() as $label => $days): ?>
                            <span class="badge grey"><?= htmlspecialchars($label); ?> ‚Äî <?= round($days, 1); ?> jours</span>
                        <?php endforeach; ?>
                    <?php endif; ?>

                    <!-- D√©tails temps par status -->
                    <details>
                        <summary>D√©tails du temps pass√© par status, hors Termin√©s</summary>
                        <ul>
                            <?php $issueTimelineData = $issue->getTimeByStatus(true); ?>
                            <?php if (is_array($issueTimelineData['workflowStatuses']) && !empty($issueTimelineData['workflowStatuses'])): ?>
                                <?php foreach ($issueTimelineData['workflowStatuses'] as $status => $days): ?>
                                    <li><?= $view->normalizeStatusName($status); ?> : <strong><?= round($days, 2); ?> jours</strong></li>
                                <?php endforeach; ?>
                            <?php endif; ?>

                            <?php if (is_array($issueTimelineData['otherStatuses']) && !empty($issueTimelineData['otherStatuses'])): ?>
                                <br />
                                Autres statuts :
                                <?php foreach ($issueTimelineData['otherStatuses'] as $status => $days): ?>
                                    <li><?= $view->normalizeStatusName($status); ?> : <strong><?= round($days, 2); ?> jours</strong></li>
                                <?php endforeach; ?>
                            <?php endif; ?>
                        </ul>
                    </details>
                    <!-- D√©tails temps par cat√©gorie de status -->
                    <details>
                        <summary>Totaux temps pass√© par √©tapes du cycle de vie du ticket</summary>
                        <ul>
                            <li>üß† Affinage : <strong><?= $issue->getTimeSpentInRefinement(); ?> jours</strong></li>
                            <li>‚öôÔ∏è R√©al + Qualif : <strong><?= $issue->getTimeSpentInSprint(); ?> jours</strong></li>
                            <li>‚ùì Autre : <strong><?= $issue->getTimeSpentInOther(); ?> jours</strong></li>
                        </ul>
                    </details>
                </td>
            </tr>
        <?php endforeach; ?>
    </tbody>
</table>